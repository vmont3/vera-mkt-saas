generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  govbrSub     String?  @unique
  password     String
  kycStatus    String   @default("pending")
  createdAt    DateTime @default(now())
  wallet       Wallet?
}

model Subject {
  id             String   @id @default(uuid())
  type           String
  ownerId        String
  publicMetadata Json?
  privacyPolicy  Json?
  createdAt      DateTime @default(now())
}

model Tag {
  id            String   @id
  chipUid       String
  hTrunc        String
  integrityCode String
  subjectId     String?
  status        String    @default("pending")
  createdAt     DateTime  @default(now())
}

model QrToken {
  id          String   @id @default(uuid())
  subjectId   String
  token       String   @unique
  expiresAt   DateTime
  status      String   @default("active")
}

model NFCTag {
  id                  String   @id @default(uuid())
  uid                 String   @unique
  hTrunc              String
  integrityCode       String
  counter             Int      @default(0)
  verificationCounter Int      @default(0)
  linkedSubjectId     String?
  linkedAssetId       String?
  anchorTxId          String?
  status              String   @default("active")
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

model Wallet {
  id             String   @id @default(uuid())
  userId         String   @unique
  user           User     @relation(fields: [userId], references: [id])
  creditsBalance Float    @default(0)
  moneyPending   Float    @default(0)
  moneyAvailable Float    @default(0)
}

model OfflineEvent {
  id         String   @id @default(uuid())
  subjectId  String
  rawPayload Json
  status     String   @default("pending")
  createdAt  DateTime @default(now())
}

model LifecycleEvent {
  id             String   @id @default(uuid())
  subjectId      String
  eventType      String
  merkleLeafHash String
  anchorTxid     String?
  createdAt      DateTime @default(now())
}

model ContractTemplate {
  id           String   @id @default(uuid())
  segment      String
  version      String
  templateText String
  createdAt    DateTime @default(now())
}

model Contract {
  id         String   @id @default(uuid())
  templateId String
  filledData Json
  anchorTxid String?
  createdAt  DateTime @default(now())
}

model Delegation {
  id          String   @id @default(uuid())
  ownerId     String
  delegateId  String
  scope       String
  expiresAt   DateTime?
  createdAt   DateTime @default(now())
}

model AuditLog {
  id         String   @id @default(uuid())
  actorId    String
  action     String
  details    Json?
  createdAt  DateTime @default(now())
}
